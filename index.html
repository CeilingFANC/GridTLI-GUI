<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <title>GridTLI GUI</title>
	<!-- load custom javascript file -->
	<script type="text/javascript" src="gridfunctions.js"></script>
	<!-- load custom stylesheet -->
    <link rel="stylesheet" href="style.css"></link>
	<!-- load paper.js and canvas -->
    <script type="text/javascript" src="paper-full.js"></script>
	<script type="text/javascript">
		// Make the paper scope global, by injecting it into window:
		paper.install(window);
		// Initialize List of tools
		var drawLine, drawPoints;
		// Initialize Graph values
		var timeValues = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];
		var spatialValues = [-6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6];
		spatialValues.reverse()
		var spatialDivs = 12;
		var timeDivs = 16;

		// Load the window
		window.onload = function() {
			// Setup directly from canvas id:
			paper.setup('myCanvas');
			myCanvas.style.background = '#ccc'; 
		
			var path;
			var checkX;
			var count = 0;
			var another_count=0;
			
			
			//needed for shistpoints
			var fourth=true;
			var position_index=0;
			var pre_x=50;
			var suc_x=700;
			
			var number_point=0;
			
			var path_ob_list;
			var group = new Group();
			var out = [];
			
			
			var allPathsList = [];
			var pointList = [];
			var textItem = new PointText({
				content: 'Click and drag to draw a line.',
				point: new Point(60, 30),
				fillColor: 'black',
			});

			grid = new Layer();
			drawGrid(timeDivs, spatialDivs, timeValues, spatialValues, paper.view.bounds);
			view.draw()

			

			cnvs = new Layer({
				children: path, allPathsList, pointList, textItem, checkX, count,	
			});

			// Define tool to draw the whole line segment
			drawLine = new Tool();
			drawLine.onMouseDown = function(event) {
				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					// If we produced a path before, deselect it:
					if (path) {
						path.selected = false;
					}
					// Create a new path and set its stroke color to black:
					path = new Path({
						segments: [event.point],
						strokeColor: 'black',
						// Select the path, so we can see its segment points:
						fullySelected: true
					});
				}
			}

			// While the user drags the mouse, points are added to the path
			// at the position of the mouse:
			drawLine.onMouseDrag= function(event) {
				document.getElementById('xrange').value = path.segments.length;
				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					if(count>0) {
						if(checkX.x < event.point.x) {
							path.add(event.point);
							checkX=event.point;
						}
						} else {
							path.add(event.point);
							checkX = event.point;
						}

					count++;
					
					pointList.push(event.point["x"], event.point["y"]);
					textItem.content = 'Point Coords: ' + '[' + event.point["x"] + ', ' + event.point["y"] + '], ' + "\n";

					
					// path.add(event.point);
					// Update the content of the text item to show how many
					// segments it has:
					// textItem.content = 'Segment count: ' + path.segments.length + "\n";
					// adds the x and y coords of each point to the list for the current path
					
				}else{
					path.selected = false;				
					count=0;
				}
			}

			// When the mouse is released:
			drawLine.onMouseUp = function(event) {
				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					count = 0;
					path.selected = false;	
					group.addChild(path); //good morning
					
					//path_ob_list.push(path);
					var segmentCount = path.segments.length;
					textItem.content = segmentCount;
					// add the list of points for the segment to the list of all paths
					allPathsList.push(pointList);
					// reinitilizae the pointList
					pointList = [];

					// for testing purposes, display all paths and latest path
					numPaths = allPathsList.length;
					textItem.content = allPathsList + "\n" + allPathsList[numPaths-1] + "\n";
				}
			}
			
			
			
			
			// attempt
			// Define tool to draw points and connect them
			drawPoints = new Tool();
			drawPoints.onMouseDown = function(event) {
				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					// If we produced a path before, deselect it:
					if (count!=0){
						path.selected = false;				
						count=0;		
					}

					if (another_count==0) {
						
						path = new Path({
							segments: [event.point],
							strokeColor: 'red',
							// Select the path, so we can see its segment points:
							fullySelected: true
						});
						checkX=event.point;
						another_count++;
					}else{
						if(checkX.x < event.point.x) {
						
							path.add(event.point);
							checkX=event.point;
							another_count++;
							pointList.push(event.point["x"], event.point["y"]);
						
						}
					}

				}else{

					another_count = 0;
					number_point++;
					path.selected = false;				

					group.addChild(path); //good morning

					var segmentCount = path.segments.length;
					textItem.content = segmentCount;
					// add the list of points for the segment to the list of all paths
					allPathsList.push(pointList);
					// reinitilizae the pointList
					pointList = [];	
					
					// for testing purposes, display all paths and latest path
					numPaths = allPathsList.length;
					textItem.content = allPathsList + "\n" + allPathsList[numPaths-1] + "\n";

				
				
				}
			}

			//another one 
			appendPoints = new Tool();
			appendPoints.onMouseDown = function(event) {
	

				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					// If we produced a path before, deselect it:


					if (another_count==0) {
						
						path=group.children[group.children.length-1];
						path.selected = true;				
						checkX=path.lastSegment.point;
						if (checkX.x< event.point.x){
							allPathsList[allPathsList.length-1].push(event.point.x);
							allPathsList[allPathsList.length-1].push(event.point.y);
							another_count++;	
							path.add(event.point);
						
						}

					}else{

			
						if(checkX.x < event.point.x) {
							allPathsList[allPathsList.length-1].push(event.point.x);
							allPathsList[allPathsList.length-1].push(event.point.y);					
							path.add(event.point);
							checkX=event.point;
							another_count++;
							pointList.push(event.point["x"], event.point["y"]);
						
						}
					}

				}else{

					another_count = 0;
					number_point++;
					var segmentCount = path.segments.length;
					textItem.content = segmentCount;
					// add the list of points for the segment to the list of all paths
					// reinitilizae the pointList
					pointList = [];	
					path.selected = false;				
					
					// for testing purposes, display all paths and latest path
					numPaths = allPathsList.length;
					textItem.content = allPathsList + "\n" + allPathsList[numPaths-1] + "\n";

				
				
				}
			}
			
			
			// 4.so many cookies
			shiftPoints = new Tool();
			shiftPoints.onMouseDown = function(event) {
	

				if ((50 <= event.point["x"]) && (event.point["x"] <= 700) && (10 <= event.point["y"]) && (event.point["y"] <= 460)) {
					//path=group.children[group.children.length-1];
					//first time remove point
					//path.removeSegment(2);
		
					if (fourth){
						path=group.children[group.children.length-1];
						path.selected = true;
						var arr_segments=path.segments;


						for (i=0; i<arr_segments.length;i++){
							if(close(arr_segments[i].point.x,arr_segments[i].point.y,event.point.x,event.point.y)){
								position_index=i;
								path.removeSegment(i);
								break;
							}
							pre_x=arr_segments[i].point.x;
						}
						suc_x=arr_segments[position_index+1].point.x;
						fourth=false;
						//needed to be intialized to handle boundary condition

						
					}else{
					//second time add new point
						if(pre_x<event.point.x<suc_x){
							path.insert(position_index,event.point);
							path.selected = false;
							allPathsList[allPathsList.length-1][position_index*2]=event.point.x;
							allPathsList[allPathsList.length-1][position_index*2+1]=event.point.y;
							fourth=true;
						
						}
						
					}
			
				}else{
					path.selected = false;
					fourth=true;				
				}
			}
			
			
			// check whether two point are close, used in shiftPoints
			function close(a_x,a_y,b_x,b_y){
				var dis=Math.pow(b_x-a_x,2)+Math.pow(b_y-a_y,2);
				//alert(Math.pow(b_x-a_x,2),b_x,a_x);
				return dis<16;
			}
			function transfrom(){
				var xmin=+document.getElementById(smin).value;
				var xmax=+document.getElementById(smax).value;
				var tmax=+document.getElementById(tmax).value;
				var t_x=10+((460-10)/(xmax-xmin))*(0-xmin);
				for(i=0;i<allPathsList.length;i++){
					out.push([]);
					for (j=0;j<allPathsList[i].length;j++){
						
						if(j%2==0){
							out[i].push(((allPathsList[i][j]-50)/650)*tmax);
						}else{
							out[i].push(((allPathsList[i][j]-10)/450)*(xmax-xmin)+xmin);
						}
					
					}
				
				}
			
			}

			view.draw();
			window.drawGrid = drawGrid();
		}
    </script>
</head>
<body>
	<div class="navbar">
		<a href="#">Home</a>
		<a href="#">About</a>
	</div>
	<div id="tab">
		<article id="drawingGrid">
			<canvas id="myCanvas"></canvas>
			<p class="rotate" id="label">Y Label</p>
		</article>
		<div id="threshold">
			<h3>Graph Values</h3>
			<article class="spatial">
				<article class="graphLabels">
					<p>Spatial:</p>
				</article>
				<article class="graphValues">
					<input type="text" id="smin" value="X_min"
						onblur="if (this.value == '') {this.value = 'X_min';}"
						onfocus="if (this.value == 'X_min') {this.value = '';}" />
					<br>
					<input type="text" id="smax" value="X_max"
						onblur="if (this.value == '') {this.value = 'X_max';}"
						onfocus="if (this.value == 'X_max') {this.value = '';}" />
				</article>
			</article>
			<article class="temporal">
				<article class="graphLabels">
					<p>Temporal:</p>
				</article>
				<article class="graphValues">
					<input type="text" id="tmax" value="Y_max"
						onblur="if (this.value == '') {this.value = 'Y_max';}"
						onfocus="if (this.value == 'Y_max') {this.value = '';}" />
				</article>
			</article>
			<h3 class="thresh">Threshold Values</h3>
			<article class="spatial">
				<article class="threshLabels">
					<p>Spatial:</p>
				</article>
				<article class="threshValues">
					<input type="text" id="sThresh" value="Xt"
						onblur="if (this.value == '') {this.value = 'Xt';}"
						onfocus="if (this.value == 'Xt') {this.value = '';}" />
				</article>
			</article>
			<article class="temporal">
				<article class="threshLabels">
					<p>Temporal:</p>
				</article>
				<article class="threshValues">
					<input type="text" id="tThresh" value="Yt"
						onblur="if (this.value == '') {this.value = 'Yt';}"
						onfocus="if (this.value == 'Yt') {this.value = '';}" />
				</article>
			</article>
			<article class="cluster">
				<article class="threshLabels">
					<p>Cluster:</p>
				</article>
				<article class="threshValues">
					<input type="text" id="cluster" value="Ct"
						onblur="if (this.value == '') {this.value = 'Ct';}"
						onfocus="if (this.value == 'Ct') {this.value = '';}" />
				</article>
			</article>
			<button type="button" id="changeVals" onClick="changeValues()">Run</button>
		</div>
	</div>
	<!--this section helps me check the javascript function that "run" gathers the values-->
	<br><br>
	<br><br>
	<br><br>
	<br>
	<input type="text" id="xtmin" value="1"><br>
	<input type="text" id="xtmax" value="1"><br>
	<input type="text" id="ytmax" value="1"><br>
	<input type="text" id="ct" value="1"><br>
	<input id="xrange" value="1" style="width: 300px"><br>
	<input id="yrange" value="1" style="width: 300px"><br>
	<img src="icon-pencil.png" id="pencil" onClick="drawLine.activate()" width="20px" height="20px" padding="5px">
	<img src="icon-segment.png" id ="dot" onClick="drawPoints.activate()" width="20px" height="20px" padding="5px">
	<img src="pin1.png" id ="append" onClick="appendPoints.activate()" width="20px" height="20px" padding="5px">
	<img src="pin2.png" id ="shift" onClick="shiftPoints.activate()" width="20px" height="20px" padding="5px">

</body>
</html>
